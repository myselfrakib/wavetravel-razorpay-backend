<!doctype html>
<html>
<head><meta charset="utf-8"><title>Checkout</title></head>
<body>
  <h2>Pay â‚¹5</h2>
  <input id="amount" type="number" value="5" />
  <button id="payBtn">Pay Now</button>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    async function createOrder(amount) {
      const resp = await fetch('/create-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: Number(amount) })
      });
      return resp.json();
    }

    document.getElementById('payBtn').onclick = async () => {
      const amount = document.getElementById('amount').value || 1;
      const data = await createOrder(amount);
      if (data.error) return alert('Order creation failed: ' + (data.details || data.error));

      const order = data.order;
      const options = {
        key: data.key, // public key returned by server
        amount: order.amount,
        currency: order.currency,
        name: 'Your Business',
        description: 'Test payment',
        order_id: order.id,
        handler: async function (response) {
          // response: razorpay_payment_id, razorpay_order_id, razorpay_signature
          const verify = await fetch('/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(response)
          });
          const result = await verify.json();
          if (result.status === 'ok') {
            alert('Payment successful and verified on server!');
          } else {
            alert('Payment verification failed: ' + (result.message || JSON.stringify(result)));
          }
        },
        prefill: { name: '', email: '', contact: '' },
      };

      const rzp = new Razorpay(options);
      rzp.open();
    };
  </script>
</body>
</html>
